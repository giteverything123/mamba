<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Demo01</title>
  <script src="../dist/mamba.min.js"></script>
  <script src="./MV.js"></script>
</head>
<body>
  <script>
    var vertexShader = `
      attribute vec4 vPosition;
      attribute vec4 vColor;
      uniform mat4 viewModel;
      uniform mat4 projectModel;
      uniform mat4 r;
      varying vec4 fColor;
      void main() {
        gl_Position = projectModel * viewModel * r * vPosition;
        fColor = vColor;
      }
    `
    var fragmentShader = `
      precision mediump float;
      varying vec4 fColor;
      void main() {
        gl_FragColor = fColor;
      }
    `
    var Mamba = new mamba();
    var cvs = Mamba.createCanvas(300, 300);
    var gl = Mamba.createGL();
    var points = [
      [-0.5, -0.5, 0.5, 1],//0
      [-0.5, 0.5, 0.5, 1],//1
      [0.5, 0.5, 0.5, 1],//2
      [0.5, -0.5, 0.5, 1],//3
      [-0.5, -0.5, -0.5, 1],//4
      [-0.5, 0.5, -0.5, 1],//5
      [0.5, 0.5, -0.5, 1],//6
      [0.5, -0.5, -0.5, 1]//7
    ];
    var colors = [
      [0, 0, 0, 1],//黑
      [1, 0, 0, 1],//红
      [1, 1, 0, 1],//黄
      [0, 1, 0, 1],//绿
      [0, 0, 1, 1],//蓝
      [1, 0, 1, 1],//品红
      [1, 1, 1, 1],//白
      [0, 1, 1, 1]//青
    ];

    var pointsArray = [], colorsArray = [];


    function quad(a, b, c, d) {
      var indices = [a, b, c, a, c, d];
      for(var i = 0; i < indices.length; i++) {
        pointsArray.push(points[indices[i]]);
        colorsArray.push(colors[indices[i]]);
      }
    }

    function colorCube() {
      quad(1, 0, 3, 2);
      quad(2, 3, 7, 6);
      quad(3, 0, 4, 7);
      quad(6, 5, 1, 2);
      quad(4, 5, 6, 7);
      quad(5, 4, 0, 1);
    }

    colorCube();
    var step = 0;
    Mamba.initShaders(vertexShader, fragmentShader);
    Mamba.setSize(cvs.width, cvs.height);
    Mamba.setBackGroundColor(1, 1, 1, 1);
    Mamba.setAttr('vPosition', flatten(pointsArray), 4, gl.FLOAT, 0, 0);
    Mamba.setAttr('vColor', flatten(colorsArray), 4, gl.FLOAT, 0, 0);
    Mamba.setMatrix('viewModel', 4, Mamba.lookAt([0,1,2],[0,0,0],[0,1,0]));
    Mamba.setMatrix('projectModel', 4, Mamba.perspective(45, 1, 1, 6));
    function render() {
      step += 0.01;
      var cos = Math.cos(step);
      var sin = Math.sin(step);
      Mamba.setMatrix('r', 4, new Float32Array([
        cos, 0, -sin, 0,
        0, 1, 0, 0,
        sin, 0, cos, 0,
        0, 0, 0, 1
      ]));
      Mamba.render(36);
      requestAnimationFrame(render);
    }
    render()
  </script>
</body>
</html>